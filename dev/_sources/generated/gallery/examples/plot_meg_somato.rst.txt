
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "generated/gallery/examples/plot_meg_somato.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_generated_gallery_examples_plot_meg_somato.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_generated_gallery_examples_plot_meg_somato.py:


Source localization of somatosensory MEG data
=============================================

This example adapts the experiment presented in
:footcite:t:`chevalier2020statistical`. We show how to identify which cortical
sources are activated during a somatosensory task. To do so, we leverage
spatially constrained clustering to effectively reduce the dimensionality of
the problem while accounting for the spatial structure of the data. We then
perform inference with the desparsified multitask Lasso to perform support
recovery from spatio-temporal data.

.. admonition:: MultiTaskLasso:

    The `MultiTaskLasso <https://scikit-learn.org/stable/modules/linear_model.html#multi-task-lasso>`_
    is a linear model that estimates sparse coefficients for multiple correlated
    tasks simultaneously. Here, the tasks correspond to the different time points.
    Instead of fitting a separate Lasso model for each time point, it fits a single
    model that enforces joint feature selection across all time points. To do so,
    it uses an L1/L2 mixed-norm regularization, which for a coefficient matrix
    :math:`W` of shape (n_features, n_tasks) is defined as:

    .. math::
        ||W||_{21} = \sum_{j=1}^p \sqrt{\sum_{t=1}^T W_{j,t}^2}

.. GENERATED FROM PYTHON SOURCE LINES 29-33

Load somatosensory MEG data from MNE-Python
-------------------------------------------
We use the somatosensory MEG dataset available in MNE-Python. We visualize
the evoked response across MEG sensors.

.. GENERATED FROM PYTHON SOURCE LINES 33-74

.. code-block:: Python


    import mne
    import numpy as np
    from mne.datasets import somato

    cond = "somato"
    data_path = somato.data_path(verbose=True)
    subject = "01"
    subjects_dir = data_path / "derivatives/freesurfer/subjects"
    raw_fname = (
        data_path / f"sub-{subject}" / "meg" / f"sub-{subject}_task-{cond}_meg.fif"
    )
    fwd_fname = (
        data_path
        / "derivatives"
        / f"sub-{subject}"
        / f"sub-{subject}_task-{cond}-fwd.fif"
    )

    # Read evoked
    raw = mne.io.read_raw_fif(raw_fname)
    events = mne.find_events(raw, stim_channel="STI 014")
    reject = {"grad": 4000e-13, "eog": 350e-6}
    picks = mne.pick_types(raw.info, meg=True, eeg=True, eog=True)

    event_id, tmin, tmax = 1, -0.2, 0.25
    epochs = mne.Epochs(
        raw,
        events,
        event_id,
        tmin,
        tmax,
        picks=picks,
        reject=reject,
        preload=True,
    )
    evoked = epochs.average()
    evoked = evoked.pick_types("grad")
    evoked.plot()





.. image-sg:: /generated/gallery/examples/images/sphx_glr_plot_meg_somato_001.png
   :alt: Gradiometers (204 channels)
   :srcset: /generated/gallery/examples/images/sphx_glr_plot_meg_somato_001.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Using default location ~/mne_data for somato...
    Creating /home/circleci/mne_data
    Downloading file 'MNE-somato-data.tar.gz' from 'https://osf.io/download/tp4sg?version=7' to '/home/circleci/mne_data'.
      0%|                                               | 0.00/611M [00:00<?, ?B/s]      0%|▏                                     | 3.02M/611M [00:00<00:20, 30.2MB/s]      2%|▋                                     | 10.7M/611M [00:00<00:10, 57.5MB/s]      3%|█▏                                    | 18.4M/611M [00:00<00:08, 66.5MB/s]      4%|█▋                                    | 26.2M/611M [00:00<00:08, 70.9MB/s]      6%|██                                    | 33.9M/611M [00:00<00:07, 73.4MB/s]      7%|██▌                                   | 41.7M/611M [00:00<00:07, 74.8MB/s]      8%|███                                   | 49.6M/611M [00:00<00:07, 76.0MB/s]      9%|███▌                                  | 57.3M/611M [00:00<00:07, 76.6MB/s]     11%|████                                  | 65.1M/611M [00:00<00:07, 77.0MB/s]     12%|████▌                                 | 72.9M/611M [00:01<00:06, 77.3MB/s]     13%|█████                                 | 80.7M/611M [00:01<00:06, 77.4MB/s]     15%|█████▌                                | 88.5M/611M [00:01<00:06, 77.8MB/s]     16%|█████▉                                | 96.3M/611M [00:01<00:06, 77.7MB/s]     17%|██████▋                                | 104M/611M [00:01<00:06, 77.7MB/s]     18%|███████▏                               | 112M/611M [00:01<00:06, 77.7MB/s]     20%|███████▋                               | 120M/611M [00:01<00:06, 77.8MB/s]     21%|████████▏                              | 127M/611M [00:01<00:06, 77.9MB/s]     22%|████████▋                              | 135M/611M [00:01<00:06, 77.6MB/s]     23%|█████████▏                             | 143M/611M [00:01<00:06, 77.7MB/s]     25%|█████████▋                             | 151M/611M [00:02<00:05, 77.8MB/s]     26%|██████████▏                            | 159M/611M [00:02<00:05, 77.2MB/s]     27%|██████████▋                            | 166M/611M [00:02<00:05, 77.3MB/s]     29%|███████████▏                           | 174M/611M [00:02<00:05, 77.4MB/s]     30%|███████████▌                           | 182M/611M [00:02<00:05, 77.5MB/s]     31%|████████████                           | 190M/611M [00:02<00:05, 77.2MB/s]     32%|████████████▌                          | 197M/611M [00:02<00:05, 76.2MB/s]     34%|█████████████                          | 205M/611M [00:02<00:05, 76.5MB/s]     35%|█████████████▌                         | 213M/611M [00:02<00:05, 76.5MB/s]     36%|██████████████                         | 220M/611M [00:02<00:05, 75.9MB/s]     37%|██████████████▌                        | 228M/611M [00:03<00:05, 75.7MB/s]     39%|███████████████                        | 236M/611M [00:03<00:04, 75.9MB/s]     40%|███████████████▌                       | 244M/611M [00:03<00:04, 76.6MB/s]     41%|████████████████                       | 251M/611M [00:03<00:04, 76.3MB/s]     42%|████████████████▌                      | 259M/611M [00:03<00:04, 75.6MB/s]     44%|█████████████████                      | 266M/611M [00:03<00:04, 70.6MB/s]     45%|█████████████████▍                     | 274M/611M [00:03<00:04, 71.5MB/s]     46%|█████████████████▉                     | 281M/611M [00:03<00:04, 73.1MB/s]     47%|██████████████████▍                    | 289M/611M [00:03<00:04, 74.4MB/s]     49%|██████████████████▉                    | 297M/611M [00:03<00:04, 75.3MB/s]     50%|███████████████████▍                   | 305M/611M [00:04<00:04, 76.2MB/s]     51%|███████████████████▉                   | 313M/611M [00:04<00:03, 76.7MB/s]     52%|████████████████████▍                  | 320M/611M [00:04<00:03, 77.0MB/s]     54%|████████████████████▉                  | 328M/611M [00:04<00:03, 77.3MB/s]     55%|█████████████████████▍                 | 336M/611M [00:04<00:03, 77.4MB/s]     56%|█████████████████████▉                 | 344M/611M [00:04<00:03, 77.4MB/s]     58%|██████████████████████▍                | 351M/611M [00:04<00:03, 77.6MB/s]     59%|██████████████████████▉                | 359M/611M [00:04<00:03, 77.6MB/s]     60%|███████████████████████▍               | 367M/611M [00:04<00:03, 77.7MB/s]     61%|███████████████████████▉               | 375M/611M [00:04<00:03, 77.6MB/s]     63%|████████████████████████▍              | 383M/611M [00:05<00:02, 77.5MB/s]     64%|████████████████████████▉              | 390M/611M [00:05<00:02, 77.5MB/s]     65%|█████████████████████████▍             | 398M/611M [00:05<00:02, 77.7MB/s]     66%|█████████████████████████▉             | 406M/611M [00:05<00:02, 77.6MB/s]     68%|██████████████████████████▍            | 414M/611M [00:05<00:02, 77.7MB/s]     69%|██████████████████████████▉            | 421M/611M [00:05<00:02, 77.7MB/s]     70%|███████████████████████████▍           | 429M/611M [00:05<00:02, 77.9MB/s]     72%|███████████████████████████▉           | 437M/611M [00:05<00:02, 77.8MB/s]     73%|████████████████████████████▍          | 445M/611M [00:05<00:02, 74.4MB/s]     74%|████████████████████████████▉          | 453M/611M [00:05<00:02, 75.2MB/s]     75%|█████████████████████████████▍         | 460M/611M [00:06<00:01, 76.0MB/s]     77%|█████████████████████████████▉         | 468M/611M [00:06<00:01, 76.5MB/s]     78%|██████████████████████████████▍        | 476M/611M [00:06<00:01, 77.0MB/s]     79%|██████████████████████████████▉        | 484M/611M [00:06<00:01, 77.1MB/s]     80%|███████████████████████████████▍       | 491M/611M [00:06<00:01, 77.0MB/s]     82%|███████████████████████████████▉       | 499M/611M [00:06<00:01, 77.2MB/s]     83%|████████████████████████████████▍      | 507M/611M [00:06<00:01, 77.0MB/s]     84%|████████████████████████████████▉      | 515M/611M [00:06<00:01, 77.2MB/s]     86%|█████████████████████████████████▎     | 522M/611M [00:06<00:01, 77.3MB/s]     87%|█████████████████████████████████▊     | 530M/611M [00:06<00:01, 71.9MB/s]     88%|██████████████████████████████████▎    | 538M/611M [00:07<00:00, 73.2MB/s]     89%|██████████████████████████████████▊    | 545M/611M [00:07<00:00, 74.2MB/s]     91%|███████████████████████████████████▎   | 553M/611M [00:07<00:00, 74.7MB/s]     92%|███████████████████████████████████▊   | 561M/611M [00:07<00:00, 75.1MB/s]     93%|████████████████████████████████████▎  | 568M/611M [00:07<00:00, 75.4MB/s]     94%|████████████████████████████████████▊  | 576M/611M [00:07<00:00, 75.8MB/s]     96%|█████████████████████████████████████▎ | 584M/611M [00:07<00:00, 76.1MB/s]     97%|█████████████████████████████████████▊ | 591M/611M [00:07<00:00, 76.4MB/s]     98%|██████████████████████████████████████▎| 599M/611M [00:07<00:00, 76.5MB/s]     99%|██████████████████████████████████████▊| 607M/611M [00:07<00:00, 76.5MB/s]      0%|                                               | 0.00/611M [00:00<?, ?B/s]    100%|███████████████████████████████████████| 611M/611M [00:00<00:00, 1.81TB/s]
    Untarring contents of '/home/circleci/mne_data/MNE-somato-data.tar.gz' to '/home/circleci/mne_data'
    Attempting to create new mne-python configuration file:
    /home/circleci/.mne/mne-python.json
    Could not read the /home/circleci/.mne/mne-python.json json file during the writing. Assuming it is empty. Got: Expecting value: line 1 column 1 (char 0)
    Download complete in 20s (582.2 MB)
    Opening raw data file /home/circleci/mne_data/MNE-somato-data/sub-01/meg/sub-01_task-somato_meg.fif...
        Range : 237600 ... 506999 =    791.189 ...  1688.266 secs
    Ready.
    Finding events on: STI 014
    111 events found on stim channel STI 014
    Event IDs: [1]
    Not setting metadata
    111 matching events found
    Setting baseline interval to [-0.19979521315838786, 0.0] s
    Applying baseline correction (mode: mean)
    0 projection items activated
    Loading data for 111 events and 136 original time points ...
    0 bad epochs dropped
    NOTE: pick_types() is a legacy function. New code should use inst.pick(...).

    <Figure size 640x300 with 2 Axes>



.. GENERATED FROM PYTHON SOURCE LINES 75-83

Preprocessing MEG data for source localization
----------------------------------------------
Before performing source localization, we need to preprocess the MEG data.
To do so we rely on the MNE-Python library. We compute the forward model,
which describes how the activity of cortical sources is projected onto MEG
sensors. We also select the time window of interest, which is the early
response. Finally we compute the noise covariance matrix, in order to whiten
the data.

.. GENERATED FROM PYTHON SOURCE LINES 83-108

.. code-block:: Python


    from mne.inverse_sparse.mxne_inverse import _prepare_gain

    # Read forward matrix
    forward = mne.read_forward_solution(fwd_fname)
    # Compute noise covariance matrix
    noise_cov = mne.compute_covariance(epochs, rank="info", tmax=0.0)
    # We must reduce the whitener since data were preprocessed for removal
    # of environmental noise with maxwell filter leading to an effective
    # number of 64 samples.
    pca = True
    # Preprocessing MEG data
    forward, gain, gain_info, whitener, _, _ = _prepare_gain(
        forward,
        evoked.info,
        noise_cov,
        pca=pca,
        depth=0.0,
        loose=0.0,
        weights=None,
        weights_min=None,
        rank=None,
    )






.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Reading forward solution from /home/circleci/mne_data/MNE-somato-data/derivatives/sub-01/sub-01_task-somato-fwd.fif...
        Reading a source space...
        [done]
        Reading a source space...
        [done]
        2 source spaces read
        Desired named matrix (kind = 3523 (FIFF_MNE_FORWARD_SOLUTION_GRAD)) not available
        Read MEG forward solution (8155 sources, 306 channels, free orientations)
        Source spaces transformed to the forward solution coordinate frame
        Setting small MEG eigenvalues to zero (without PCA)
    Reducing data rank from 306 -> 64
    Estimating covariance using EMPIRICAL
    Done.
    Number of samples used : 6771
    [done]
    Converting forward solution to fixed orientation
        No patch info available. The standard source space normals will be employed in the rotation to the local surface coordinates....
        Changing to fixed-orientation forward solution with surface-based source orientations...
        [done]
    Computing inverse operator with 204 channels.
        204 out of 306 channels remain after picking
    Selected 204 channels
    Whitening the forward solution.
    Computing rank from covariance with rank=None
        Using tolerance 2.1e-12 (2.2e-16 eps * 204 dim * 46  max singular value)
        Estimated rank (grad): 64
        GRAD: rank 64 computed from 204 data channels with 0 projectors
        Setting small GRAD eigenvalues to zero (without PCA)
    Creating the source covariance matrix
    Adjusting source covariance matrix.




.. GENERATED FROM PYTHON SOURCE LINES 109-110

Selecting relevant time window: focusing on early signal

.. GENERATED FROM PYTHON SOURCE LINES 110-122

.. code-block:: Python


    t_min, t_max = 0.01, 0.05
    t_step = 1.0 / 300
    # Croping evoked according to relevant time window
    evoked.crop(tmin=t_min, tmax=t_max)
    # Choosing frequency and number of clusters used for compression.
    # Reducing the frequency to 100Hz to make inference faster
    step = int(t_step * evoked.info["sfreq"])
    evoked.decimate(step)
    y = np.dot(whitener, evoked.data)









.. GENERATED FROM PYTHON SOURCE LINES 123-131

Spatially constrained clustering
--------------------------------
We then extract the spatial adjacency matrix that is then used in the
clustering step to incorporate the spatial structure of the data.
For MEG data ``n_clusters = 750`` is generally a good default choice.
Taking ``n_clusters > 2000`` might lead to an unpowerful inference.
Taking ``n_clusters < 500`` might compress too much the data leading
to a compressed problem not close enough to the original problem.

.. GENERATED FROM PYTHON SOURCE LINES 131-141

.. code-block:: Python


    from sklearn.cluster import FeatureAgglomeration

    # Collecting features' connectivity
    connectivity = mne.source_estimate.spatial_src_adjacency(forward["src"])

    n_clusters = 750
    ward = FeatureAgglomeration(n_clusters=n_clusters, connectivity=connectivity)






.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    -- number of adjacent vertices : 8196
    /home/circleci/project/examples/plot_meg_somato.py:135: RuntimeWarning: 0.5% of original source space vertices have been omitted, tri-based adjacency will have holes.
    Consider using distance-based adjacency or morphing data to all source space vertices.
      connectivity = mne.source_estimate.spatial_src_adjacency(forward["src"])




.. GENERATED FROM PYTHON SOURCE LINES 142-147

Running clustered inference
---------------------------
We can now run the clustered inference using the desparsified multitask Lasso
We then select the clusters that are significant at the target FWER level,
which is set to 0.1 in this example.

.. GENERATED FROM PYTHON SOURCE LINES 147-167

.. code-block:: Python


    from sklearn.linear_model import MultiTaskLassoCV

    from hidimstat import CluDL, DesparsifiedLasso

    # Setting theoretical FWER target
    fwer_target = 0.1

    cludl = CluDL(
        clustering=ward,
        desparsified_lasso=DesparsifiedLasso(estimator=MultiTaskLassoCV()),
        random_state=0,
    )

    cludl.fit_importance(gain, y)
    selected = cludl.fwer_selection(fwer_target, two_tailed_test=True)
    # multiplying the -log10(p-value) map by the sign of the estimated coefficients
    log_pvalues = -np.log10(cludl.pvalues_) * selected






.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    /home/circleci/project/.venv/lib/python3.13/site-packages/sklearn/cluster/_agglomerative.py:323: UserWarning: the number of connected components of the connectivity matrix is 2 > 1. Completing it to avoid stopping the tree early.
      connectivity, n_connected_components = _fix_connectivity(
    Group reid: AR1 cov estimation
    Using number of clusters for multiple testing correction.




.. GENERATED FROM PYTHON SOURCE LINES 168-173

We here used CluDL, which relies on a single clustering. Alternatively,
:class:`~hidimstat.EnCluDL` can be used, which relies on aggregating the
results over multiple clusterings obtained by running the clustering
algorithm on bootstrapped samples of the data. This can lead to more stable
results at the cost of a higher computational time.

.. GENERATED FROM PYTHON SOURCE LINES 176-181

Visualize the p-value map on the brain surface
----------------------------------------------
We then visualize the identified cortical sources on the brain surface. We
plot the -log10(p-value) map to which we assign the sign of the estimated
coefficient in the multitask Lasso model.

.. GENERATED FROM PYTHON SOURCE LINES 181-214

.. code-block:: Python


    from pathlib import Path

    import matplotlib.pyplot as plt
    from nilearn import datasets, plotting

    stc_pvals = mne.SourceEstimate(
        data=log_pvalues[:, np.newaxis],
        vertices=[forward["src"][0]["vertno"], forward["src"][1]["vertno"]],
        tmin=0.0,
        tstep=1.0,
        subject=f"{subject}",
    )

    # TODO: tmp fix: unlinking fsaverage directory to avoid error
    fs_dir = Path(subjects_dir) / "fsaverage"
    if fs_dir.is_symlink():
        fs_dir.unlink()
    mne.datasets.fetch_fsaverage(subjects_dir=subjects_dir)

    morph = mne.compute_source_morph(
        src=forward["src"],
        subject_from=f"{subject}",
        subject_to="fsaverage",
        subjects_dir=subjects_dir,
        spacing=5,
    )
    stc_fsaverage = morph.apply(stc_pvals)

    start_id = stc_fsaverage.data.shape[0] // 2
    rh_stat_map = stc_fsaverage.data[start_id:, 0]






.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    179 files missing from root.txt in /home/circleci/mne_data/MNE-somato-data/derivatives/freesurfer/subjects
    Downloading missing files remotely
    Downloading data from 'https://osf.io/download/3bxqt?version=2' to file '/tmp/tmpc47q4y1o/temp.zip'.
      0%|                                               | 0.00/196M [00:00<?, ?B/s]      2%|▌                                     | 2.96M/196M [00:00<00:06, 29.6MB/s]      5%|██                                    | 10.4M/196M [00:00<00:03, 55.8MB/s]      9%|███▍                                  | 17.8M/196M [00:00<00:02, 64.4MB/s]     13%|████▉                                 | 25.4M/196M [00:00<00:02, 68.7MB/s]     17%|██████▍                               | 32.9M/196M [00:00<00:02, 71.0MB/s]     21%|███████▊                              | 40.5M/196M [00:00<00:02, 72.7MB/s]     25%|█████████▎                            | 48.0M/196M [00:00<00:02, 73.6MB/s]     28%|██████████▊                           | 55.5M/196M [00:00<00:01, 74.1MB/s]     32%|████████████▎                         | 63.1M/196M [00:00<00:01, 74.6MB/s]     36%|█████████████▋                        | 70.7M/196M [00:01<00:01, 75.0MB/s]     40%|███████████████▏                      | 78.3M/196M [00:01<00:01, 75.2MB/s]     44%|████████████████▋                     | 85.8M/196M [00:01<00:01, 75.0MB/s]     48%|██████████████████                    | 93.3M/196M [00:01<00:01, 75.0MB/s]     51%|████████████████████                   | 101M/196M [00:01<00:01, 75.0MB/s]     55%|█████████████████████▌                 | 108M/196M [00:01<00:01, 74.7MB/s]     59%|███████████████████████                | 116M/196M [00:01<00:01, 74.8MB/s]     63%|████████████████████████▌              | 123M/196M [00:01<00:00, 74.9MB/s]     67%|██████████████████████████             | 131M/196M [00:01<00:00, 75.1MB/s]     71%|███████████████████████████▌           | 138M/196M [00:01<00:00, 59.4MB/s]     75%|█████████████████████████████          | 146M/196M [00:02<00:00, 63.5MB/s]     78%|██████████████████████████████▌        | 154M/196M [00:02<00:00, 66.8MB/s]     82%|████████████████████████████████       | 161M/196M [00:02<00:00, 69.4MB/s]     86%|█████████████████████████████████▌     | 169M/196M [00:02<00:00, 71.2MB/s]     90%|███████████████████████████████████    | 176M/196M [00:02<00:00, 72.4MB/s]     94%|████████████████████████████████████▋  | 184M/196M [00:02<00:00, 73.5MB/s]     98%|██████████████████████████████████████▏| 192M/196M [00:02<00:00, 74.4MB/s]      0%|                                               | 0.00/196M [00:00<?, ?B/s]    100%|████████████████████████████████████████| 196M/196M [00:00<00:00, 533GB/s]
    Extracting missing files
    Successfully extracted 179 files
    10 files missing from bem.txt in /home/circleci/mne_data/MNE-somato-data/derivatives/freesurfer/subjects/fsaverage
    Downloading missing files remotely
    Downloading data from 'https://osf.io/download/7ve8g?version=4' to file '/tmp/tmpm9b2q_nz/temp.zip'.
      0%|                                               | 0.00/239M [00:00<?, ?B/s]      1%|▍                                     | 2.96M/239M [00:00<00:07, 29.6MB/s]      4%|█▋                                    | 10.6M/239M [00:00<00:03, 57.3MB/s]      8%|██▉                                   | 18.4M/239M [00:00<00:03, 66.6MB/s]     11%|████▏                                 | 26.2M/239M [00:00<00:02, 71.0MB/s]     14%|█████▍                                | 33.9M/239M [00:00<00:02, 73.2MB/s]     17%|██████▌                               | 41.6M/239M [00:00<00:02, 74.7MB/s]     21%|███████▊                              | 49.4M/239M [00:00<00:02, 75.5MB/s]     24%|█████████                             | 57.1M/239M [00:00<00:02, 76.1MB/s]     27%|██████████▎                           | 64.9M/239M [00:00<00:02, 76.6MB/s]     30%|███████████▌                          | 72.6M/239M [00:01<00:02, 76.8MB/s]     34%|████████████▊                         | 80.4M/239M [00:01<00:02, 77.1MB/s]     37%|██████████████                        | 88.2M/239M [00:01<00:01, 77.3MB/s]     40%|███████████████▎                      | 95.9M/239M [00:01<00:01, 77.3MB/s]     43%|████████████████▉                      | 104M/239M [00:01<00:01, 77.3MB/s]     47%|██████████████████▏                    | 111M/239M [00:01<00:01, 77.4MB/s]     50%|███████████████████▍                   | 119M/239M [00:01<00:01, 77.5MB/s]     53%|████████████████████▋                  | 127M/239M [00:01<00:01, 77.6MB/s]     56%|█████████████████████▉                 | 135M/239M [00:01<00:01, 56.5MB/s]     60%|███████████████████████▎               | 143M/239M [00:02<00:01, 61.7MB/s]     63%|████████████████████████▌              | 150M/239M [00:02<00:01, 66.0MB/s]     66%|█████████████████████████▊             | 158M/239M [00:02<00:01, 69.3MB/s]     70%|███████████████████████████▏           | 166M/239M [00:02<00:01, 71.9MB/s]     73%|████████████████████████████▍          | 174M/239M [00:02<00:00, 73.8MB/s]     76%|█████████████████████████████▋         | 182M/239M [00:02<00:00, 75.2MB/s]     79%|██████████████████████████████▉        | 190M/239M [00:02<00:00, 76.1MB/s]     83%|████████████████████████████████▎      | 198M/239M [00:02<00:00, 76.8MB/s]     86%|█████████████████████████████████▌     | 205M/239M [00:02<00:00, 77.2MB/s]     89%|██████████████████████████████████▊    | 213M/239M [00:02<00:00, 77.3MB/s]     93%|████████████████████████████████████   | 221M/239M [00:03<00:00, 77.6MB/s]     96%|█████████████████████████████████████▎ | 229M/239M [00:03<00:00, 77.7MB/s]     99%|██████████████████████████████████████▋| 237M/239M [00:03<00:00, 77.9MB/s]      0%|                                               | 0.00/239M [00:00<?, ?B/s]    100%|████████████████████████████████████████| 239M/239M [00:00<00:00, 647GB/s]
    Extracting missing files
    Successfully extracted 10 files
    surface source space present ...
    Computing morph matrix...
    Morph map "/home/circleci/mne_data/MNE-somato-data/derivatives/freesurfer/subjects/morph-maps/fsaverage-01-morph.fif" does not exist, creating it and saving it to disk
    Creating morph map 01 -> fsaverage
    Creating morph map fsaverage -> 01
        13 smooth iterations done.
        12 smooth iterations done.
    [done]
    [done]




.. GENERATED FROM PYTHON SOURCE LINES 215-245

.. code-block:: Python


    fsaverage = datasets.fetch_surf_fsaverage("fsaverage5")

    fig, axes = plt.subplots(
        1,
        2,
        subplot_kw={"projection": "3d"},
        figsize=(8, 5),
        gridspec_kw={"hspace": -0.1},
    )

    # sphinx_gallery_thumbnail_number = 2
    for ax, view in zip(axes, ["lateral", "medial"], strict=True):
        plotting.plot_surf_stat_map(
            surf_mesh=fsaverage.infl_right,
            stat_map=rh_stat_map,
            bg_map=fsaverage.sulc_right,
            hemi="right",
            view=view,
            colorbar=True,
            cmap="RdBu_r",
            threshold=-np.log10(fwer_target),
            vmax=10,
            axes=ax,
            title=f"rh-{view} view",
        )

    ax._colorbars[0].set_ylabel("-log10(p-value)")
    plotting.show()




.. image-sg:: /generated/gallery/examples/images/sphx_glr_plot_meg_somato_002.png
   :alt: rh-lateral view, rh-medial view
   :srcset: /generated/gallery/examples/images/sphx_glr_plot_meg_somato_002.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    /home/circleci/project/examples/plot_meg_somato.py:243: UserWarning: You are using the 'agg' matplotlib backend that is non-interactive.
    No figure will be plotted when calling matplotlib.pyplot.show() or nilearn.plotting.show().
    You can fix this by installing a different backend: for example via
            pip install PyQt6
      plotting.show()




.. GENERATED FROM PYTHON SOURCE LINES 246-248

Most of the identified sources are located in the somatosensory cortex,
which is expected for this somatosensory task.

.. GENERATED FROM PYTHON SOURCE LINES 250-253

References
----------
.. footbibliography::


.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (1 minutes 34.186 seconds)

**Estimated memory usage:**  3068 MB


.. _sphx_glr_download_generated_gallery_examples_plot_meg_somato.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_meg_somato.ipynb <plot_meg_somato.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_meg_somato.py <plot_meg_somato.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: plot_meg_somato.zip <plot_meg_somato.zip>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
